{# This report is generated by running:
  "resilient-sdk validate -p <path_to_package>"
  or
  "resilient-sdk validate -p <path_to_package> --<any_subcommand>"

  The report is generated each time the validate command is run and it will be
  output to a file named /dist/validate_report_<timestamp>.md so as to create a record
  of validation runs
#}


{# BASIC INFO #}
# Validation Report for {{ display_name|defaults }}

| SDK Version       | Generation Time          |
| :---------------- | ------------------------ |
| {{ sdk_version }} | {{ timestamp|datetime }} |

{% if "details" in validate_issues_dict %}
## App Details
{# APP DETAILS #}
| Attribute | Value |
| --------- | ----- |
{% for attr, val in validate_issues_dict["details"] %}
{% if val|is_dict %}
| `{{ attr }}` | {{ val|pprint|replace("\n", "<br>")|defaults }} |
{% else %}
| `{{ attr }}` | {{ val|replace("\n", "")|defaults }} |
{% endif %}
{% endfor %}
{% endif %}

---


{# SETUP.PY values if ran #}
{% if "setup.py" in validate_issues_dict %}
## `setup.py` file validation
| Severity | Name | Description | Solution |
| --- | --- | --- | --- |
{% for issue in validate_issues_dict["setup.py"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
| {{ issue.severity_to_color() }} | {{ issue.name|scrub_ansi|code|dot_py }} | {{ issue.description|scrub_ansi|code|dot_py }} | {{ issue.solution|scrub_ansi|code|dot_py }} |
{% endif %}
{% endfor %}

{# check if the validation passes #}
{% if validate_issues_dict["setup.py"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %}


{# PACKAGE FILES values if ran #}
{% if "package files" in validate_issues_dict %}
## Package files validation
{% for issue in validate_issues_dict["package files"] %}

### {{ issue.name|scrub_ansi|code|dot_py }}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|code|dot_py|diff }}

{{ issue.solution|scrub_ansi|code|dot_py }}

{% else %}
<span style="color:green">Pass</span>

{% endif %}
{% endfor %} {# endfor all package files issues#}

---
{% endif %} {# endif package files exists #}


{# SELFTEST if ran #}
{% if "selftest.py" in validate_issues_dict %}
## `resilient-circuits` selftest
{% for issue in validate_issues_dict["selftest.py"] %}
{% if issue.severity <= SEVERITY_THRESHOLD %}
{{ issue.severity_to_color() }}: {{ issue.description|scrub_ansi|code|dot_py }}

{{ issue.solution|scrub_ansi|code|dot_py }}
{% endif %}
{% endfor %}
{% if validate_issues_dict["selftest.py"][0].severity > SEVERITY_THRESHOLD %}
<span style="color:green">Success</span>

{% endif %}

---
{% endif %}